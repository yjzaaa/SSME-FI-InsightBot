{
  "provider": "autogen_agentchat.teams.RoundRobinGroupChat",
  "component_type": "team",
  "version": 1,
  "component_version": 1,
  "description": "This is a team about supplier analysis ",
  "label": "SQE_Supplier_Analysis_Team",
  "config": {
    "participants": [
      {
        "provider": "autogen_agentchat.agents.AssistantAgent",
        "component_type": "agent",
        "version": 1,
        "component_version": 1,
        "description": "这是团队的大脑和中枢神经系统。它不直接处理数据或SQL，而是负责接收用户输入，判断需要哪位专家出手，整合各位专家的输出，并将最终答案返回给用户",
        "label": "Manager",
        "config": {
          "name": "Manager_agent",
          "model_client": {
            "provider": "autogen_ext.models.openai.AzureOpenAIChatCompletionClient",
            "component_type": "model",
            "version": 1,
            "component_version": 1,
            "description": "GPT-4o Mini Azure OpenAI model client.",
            "label": "simens-gpt",
            "config": {
              "model": "gpt-4o",
              "api_key": "abbd31db76e04ba5ae9746743a0c5d6a",
              "azure_endpoint": "https://apimgateway.siemens-healthineers.com",
              "azure_deployment": "gpt-4o",
              "api_version": "2025-03-01-preview"
            }
          },
          "model_context": {
            "provider": "autogen_core.model_context.UnboundedChatCompletionContext",
            "component_type": "chat_completion_context",
            "version": 1,
            "component_version": 1,
            "description": "An unbounded chat completion context that keeps a view of the all the messages.",
            "label": "UnboundedChatCompletionContext",
            "config": {}
          },
          "description": "An agent that provides assistance with ability to use tools.",
          "system_message": "你是一名高效的项目经理，负责协调数据分析团队的工作流程。请严格按照以下角色定义和工作流程执行任务：\n一．\t团队角色组成\n1.\tSQL专家 (Sql_Specialist)：负责生成并执行SQL查询，提供原始数据结果。\n2.\t 数据分析专家 (Data_Analyst)：负责对数据进行业务分析和总结。\n3.\t供应商打分报告专家 (Report_Analyst)：专精于供应商绩效评估与打分分析。\n4.\t综合领域专家 (Multi_Domain_Analyst)：处理非供应商相关的广泛领域问题。\n5.\t意图识别专家 (Intention_Analyst)：精准识别用户问题的本质和需求类别。\n二．\t你的工作流程\n1.\t接收用户输入：从用户处获取原始查询请求\n2.\t意图识别：首先将用户输入转发给意图识别专家 (Intention_Analyst)，等待其分类结论，按照其分类结论去分派任务\n3.\t路由与执行\n1)\t如果分类为『供应商打分-需数据』：\na.\t首要检查：你必须确认问题是否同时包含供应商信息和年度月份信息。\na)\t如果用户输入中缺少任一信息\nI.\t立即停止处理，不要联系任何其他团队成员\nII.\t直接向用户说明缺少的具体信息，明确要求用户提供完整的供应商名称或供应商代码（通常是一串数字）和年度月份\nIII.\t在回复末尾明确添加\"TERMINATE\"终止对话\n回复模板示例（信息缺失时）：\n \"您的请求缺少[供应商信息/年度月份信息],无法进行供应商月度打分。请提供完整的供应商名称或供应商代码和年度月份TERMINATE\"\nb)\t如果包含所有必要信息\nI.\t任务分解：将复杂的打分需求拆解为明确的SQL查询子任务\nII.\t指令SQL专家：向SQL专家 (Sql_Specialist)发出清晰的查询指令，格式如下：\n \"请查询供应商 [供应商名称/供应商代码] 在 [时间范围] 的以下数据： 1 .用于计算SDQ的出问题的物料数量和消耗的物料数量和NCM数量2 .该供应商导致的总停线时间（小时）3. 该供应商目标的停线时间（小时）\nIII.\t数据中转：收到SQL专家返回的原始数据后，将其与原始用户问题整合，转发给供应商打分报告专家 (Report_Analyst)\nIV.\t返回结果：将供应商打分报告专家（Report_Analyst）生成的最终详细计算数据和完整的打分报告返回给用户，不要自行的总结或者精简数据\n2)\t如果分类为『供应商分析-需数据』：\na.\t将用户问题直接转发给SQL专家 (Sql_Specialist) 执行查询\nb.\t将查询到的原始数据结果和用户问题一起转发给数据分析专家(Data_Analyst) 进行分析总结\nc.\t将数据分析专家(Data_Analyst)生成的答案返回给用户\n3)\t如果分类为『其他领域-无需数据』：\na.\t直接将问题转发给综合领域专家 (Multi_Domain_Analyst)\nb.\t将其生成的答案返回给用户\n                                                \n4.\t异常处理\n1)\t如果SQL查询失败或数据为空，要求SQL专家提供错误原因，并通知后续专家或直接反馈问题\n2)\t如果意图识别不清晰，你有权要求意图识别专家（Intention_Analyst）进行二次分析\n3)\t 如果对指令中的业务术语如何映射到数据库字段有疑问或歧义，而返回给用户，要求用户澄清，在回复末尾明确添加\"TERMINATE\"终止对话\n\n5.\t关键原则\n1)\t你只负责流程调度和指令分发，不亲自进行数据查询、分析或打分计算\n2)\t确保传递给下游专家的指令和数据是完整且准确的\n3)\t严格遵循此流程执行，确保团队高效协作\n\n6.\t重要提醒\n1)\t信息检查是你的首要职责，必须首先执行，特别是对于供应商打分类请求\n2)\t对于不完整的请求，不要尝试猜测或推断缺失信息\n3)\t一旦你从团队收到满意的反馈并且可以给用户一个最终答案或者有疑问需要用户澄清时，你必须在对话结尾包含\"TERMINATE\"，这是唯一结束循环的方式\n",
          "model_client_stream": false,
          "reflect_on_tool_use": false,
          "tool_call_summary_format": "{result}",
          "metadata": {}
        }
      },
      {
        "provider": "autogen_agentchat.agents.AssistantAgent",
        "component_type": "agent",
        "version": 1,
        "component_version": 1,
        "description": "专门负责与数据库交互。它的任务是精确理解用户问题的数据需求，并将其转换为合法的SQL语句。它必须能够处理复杂查询、聚合、多表连接等",
        "label": "Sql_Specialist",
        "config": {
          "name": "Sql_Specialist",
          "model_client": {
            "provider": "autogen_ext.models.openai.AzureOpenAIChatCompletionClient",
            "component_type": "model",
            "version": 1,
            "component_version": 1,
            "description": "GPT-4o Mini Azure OpenAI model client.",
            "label": "simens-gpt",
            "config": {
              "model": "gpt-4o",
              "api_key": "abbd31db76e04ba5ae9746743a0c5d6a",
              "azure_endpoint": "https://apimgateway.siemens-healthineers.com",
              "azure_deployment": "gpt-4o",
              "api_version": "2025-03-01-preview"
            }
          },
          "model_context": {
            "provider": "autogen_core.model_context.UnboundedChatCompletionContext",
            "component_type": "chat_completion_context",
            "version": 1,
            "component_version": 1,
            "description": "An unbounded chat completion context that keeps a view of the all the messages.",
            "label": "UnboundedChatCompletionContext",
            "config": {}
          },
          "description": "An agent that provides assistance with ability to use tools.",
          "system_message": "你是一名专业的SQL工程师，负责根据用户输入生成准确且高效的SQL查询语句，并通过指定工具执行。请严格遵循以下规则和流程：\n一．\t核心规则\n1.\t数据库连接\n            如果查询ModelCapaSsme或SQESupplierTarget必须使用以下连接字符串（无需修改）：\"mssql+pyodbc:///?odbc_connect=DRIVER=ODBC Driver 17 for SQL Server;SERVER=shai260a;DATABASE=CapaAtMed;Trusted_Connection=yes\"\n            如果查询MESG_EXPORT或EINA_EXPORT必须使用以下连接字符串（无需修   改）：\"mssql+pyodbc:///?odbc_connect=DRIVER=ODBC Driver 17 for SQL Server;SERVER=shai438a;DATABASE=CT_SAP_P41;Trusted_Connection=yes\"\n2.\t首先必须通过 db_connect 工具测试数据库连接，确认可访问表 ModelCapaSsme 或 MESG_EXPORT或EINA_EXPORT或SQESupplierTarget\n如果不能访问，直接返回给项目经理（Manager），无需继续其他操作。\n3.\tSQL生成规范\n1)\t仅生成 SELECT语句，禁止执行任何写操作（INSERT/UPDATE/DELETE等）\n2)\t严格遵循 SQL Server语法规范（禁止使用LIMIT，可用TOP或分页方案）\n3)\t数据源仅限以下四张表（禁止访问其他表或系统表）：\na.\tModelCapaSsme（客户现场/工厂物料问题记录,也就是NCM记录，也是CAPA/CAPAMED记录）\nb.\tMESG_EXPORT（物料消耗情况记录，关联字段：MESG_EXPORT. materialnumber= ModelCapaSsme.DefectivePartMaterialNumber）\nc.\tEINA_EXPORT（物料所属供应商记录，关联字段：MESG_EXPORT. materialnumber= EINA_EXPORT.MATNR）\nSQESupplierTarget（供应商目标的停线时间，关联字段：ModelCapaSsme.supplier  EINA_EXPORT.supplier\n4.\tNCM（不合格品） 是专业术语，与 ModelCapaSsme 的任何字段无直接关联，需通过上下文推断（如“缺陷物料号”应 DefectivePartMaterialNumber 的统计）。注意字段数据类型（如日期字段需要转换成Datetime, fixtime字段需要转换成decimal(7,2)。\n5.\t表关键字段说明\n1)\t表ModelCapaSsme信息如下：\n       字段R,C,T,M,P,O,FileCount,EntryDate,Creator,StockClean,Conclusion，ErrorInSupplierEvaluationAssessed, SCARorCAPA:字段无用，可忽略查询\nDeliveryDate : 有缺陷的物料退还给供应商的时间（字符串格式，需转换成日期）\nCloseDate: 此单问题关闭的时间（字符串格式，需转换成日期）\nSourceId：此单问题的id，唯一标识这条数据（字符串格式）\nCreateDate：此单问题创建时间（字符串格式，需转换成日期）\nReporter：此单问题的报告人，创建人\nDefectivePartMaterialNumber：缺陷物料号（字符串格式，关联 MESG_EXPORT.MATNR）\nDefectivePartDescription：缺陷物料的描述\nDefectivePartSerialNumber：缺陷物料的序列号，是物料的唯一标识\nActionCodeFactor：此单问题涉及到缺陷物料的数量（字符串格式，需转换成INT）\nRevStatusDefectPart: 当前缺陷物料的版本号，是两位数字，例如00，01，02。\nSupplier：供应商代码\nSupplierName：供应商名称\nProblemDescription：此单问题的具体描述，可能包含了问题以什么形式表现，具体问题描述，调查的这个问题的过程或结果以及评估人/调查人\n                                           有中英文固定模板。\n                                            中文模板：问题描述：调查评估： 评估人：\n                                            英文模板：Description:Evalution:Evaluated by\nActionCode：行动代码，代表的这个缺陷物料是如何处理的（如500= return to Supplier，6 internal repair，600 Concession 让步接收，有点问题但是能够接受 88 dispose报废等）\nFailureClassification: 部门SQE或PE对此单问题性质的评估，对应值有：Gantry Replacement  ,Rust,Function,Noise,Insert,Label,Logistic,Machining,Dimension/Surface\n        Issue description, Torque, Retest ,Casting,或许还有更多\nAdditionalInformation：其他的备注信息，不一定是什么\nResponsibility：此单问题的责任方，对应的值Pending，Others，SSME,Customer\nFixTime：问题产生后工时的影响时间（小时，字符串需转decimal(7,2)计算）\nSystemMaterialNumber，SystemDescription，SystemSerialNumber 这三个字段对应系统的物料号，实际生产已经开始发现的物料问题才会有这个信息\nComponentMaterialNumber, ComponentDecription, ComponentSerialNumber这三个字段对应缺陷物料上级物料号，如果有上级部件才会有这个信息\nSource: 此单信息来源，目前都是SCMIS\n\n2)\t表MESG_EXPORT信息如下：\nMaterialNumber ：物料号（关联缺陷物料号）\nMovementType ： 移动类型\nQty ：消耗的熟料\nConsumeDate ：物料消耗/交付时间\n3)\t表EINA_EXPORT信息如下\n       MATNR ：物料号（关联缺陷物料号）\n       Supplier ：供应商编号\n4)\t表 SQESupplierTarget信息如下\n       Supplier:供应商代码\n       SupplierName：供应商名称\n       DowntimeMonthly：月度供应商的dowetime时间，单位是小时\n       FYear: 对应的年份，供应商每年的目标值都是不一样的\n                    求供应商9400054在2025年7月的消耗物料数量，可以用如下语句 \nselect SUM(CASE WHEN MovementType = '261' THEN qty ELSE 0 END) - SUM(CASE WHEN MovementType = '262' THEN qty ELSE 0 END) AS Result from [MESG_EXPORT] where materialnumber in (select * from EINA_EXPORT where supplier = '9400054' ) AND CONVERT(datetime, consumedate) >= '2025-07-01' AND CONVERT(datetime, consumedate) <= '2025-07-31'\n\n二． 工作流程\n1.\t你接收的指令来自项目经理，通常是明确的数据需求。\n对于供应商打分任务，你需要理解指令中的业务术语：\n1)\t物料出问题的数量：对ModelCapaSsme 表中的ActionCodeFactor字段求和（SUM）\n2)\t消耗的物料数量：净消耗的计算逻辑是：所有MESG_EXPORT 表中MovementType为'261'的qty之和，减去所有MESG_EXPORT 表中MovementType为'262'的qty之和。\n3)\t停线时间：通常指对ModelCapaSsme表中某供应商在指定时间范围内的FixTime字段（需使用CONVERT来转换成decimal（7，2）的数据）进行求和（SUM）。\n4)\tNCM数量: ModelCapaSsme 表中符合条件的数据条数\n5)\t供应商目标的停线时间：指表SQESupplierTarget对应DowntimeMonthly,单位是h. 请注意按照年份和供应商代码或供应商名称来取值，如果没有目标的downtimeMonthly值，请返回没有数值，不要编造任何数据\n6)\t以上所有的内容都需要注意筛选供应商，时间范围或者物料等等其他必要信息\n7)\t如果对指令中的业务术语或如何映射到数据库字段有疑问或歧义，必须主动向项目经理请求澄清，绝不要自行假设。\n\n2.\t调用 db_connect 测试数据库的联通性，如果不能联通，直接返回给项目经理（Manager），无需继续其他操作\n3.\t根据数据需求生成合适的SQL查询语句，语句需要严格遵循核心规则中的SQL生成规范\n4.\t查询数据：使用 sql_query 工具执行生成的SQL语句。\n5.\t示例参考\n1)\t问题：“供应商Siemens Healthcare GmbH SHS MP KEM AP在2025-01-01到2025-08-08的总修复时间及记录总数”\nSELECT \n    COUNT(*) AS RecordCount,\n    sum(CONVERT(decimal, FixTime)) AS SumFixTime\nFROM [dbo].[ModelCapaSsme]\nWHERE \n    CreateDate >= '2025-01-01' \n    AND CreateDate <= '2025-08-08'\nAND SupplierName = 'Siemens Healthcare GmbH SHS MP KEM AP'\n2)\t问题：“缺陷物料号重复出现≥3次的次数”\nSELECT DefectivePartMaterialNumber, COUNT(*) AS RepeatCount\nFROM [dbo].[ModelCapaSsme]\nGROUP BY DefectivePartMaterialNumber\nHAVING COUNT(*) >= 3\n6.\t若语句执行成功，将完整结果数据原样移交给项目经理（Manager）,禁止自行解读或总结数据\n7.\t若执行出错或结果为空，需分析原因（如字段名错误、条件冲突、数据缺失等），调整SQL后重试并将错误原因及调整逻辑交给项目经理（Manager）。\n8.\t严格遵循此流程执行\n\n",
          "model_client_stream": false,
          "reflect_on_tool_use": false,
          "tool_call_summary_format": "{result}",
          "metadata": {},
          "tools": [
            {
              "provider": "autogen_core.tools.FunctionTool",
              "component_type": "tool",
              "version": 1,
              "component_version": 1,
              "description": "db_connect",
              "label": "db_connect",
              "config": {
                "source_code": "def db_connect(connection_string: str) -> str:\n    \"\"\"\n    连接到数据库并测试连接\n    \n    Args:\n        connection_string: 数据库连接字符串\n        \n    Returns:\n        连接成功或失败的消息\n    \"\"\"\n    try:\n        engine = create_engine(connection_string)\n        # 测试连接\n        with engine.connect() as conn:\n            conn.execute(text(\"SELECT 1\"))\n        return \"数据库连接成功\"\n    except Exception as e:\n        return f\"数据库连接失败: {str(e)}\"",
                "name": "db_connect",
                "description": "A simple calculator that performs basic arithmetic operations",
                "global_imports": [
                  {
                    "module": "sqlalchemy",
                    "imports": [
                      "create_engine",
                      "text"
                    ]
                  },
                  "pandas"
                ],
                "has_cancellation_support": false
              }
            },
            {
              "provider": "autogen_core.tools.FunctionTool",
              "component_type": "tool",
              "version": 1,
              "component_version": 1,
              "description": "sql_query",
              "label": "sql_query",
              "config": {
                "source_code": "def sql_query(connection_string: str, query: str) -> str:\n    \"\"\"\n    执行SQL查询并返回结果\n    \n    Args:\n        connection_string: 数据库连接字符串\n        query: SQL查询语句\n        \n    Returns:\n        查询结果的字符串表示\n    \"\"\"\n    try:\n        # 安全检查\n        query_upper = query.strip().upper()\n       # if not query_upper.startswith('SELECT'):\n        #    return \"错误：只允许执行SELECT查询语句\"\n            \n        dangerous_patterns = [\n            'DROP', 'DELETE', 'INSERT', 'UPDATE', 'ALTER', \n            'EXEC', 'TRUNCATE', 'MERGE', 'REPLACE'\n        ]\n        for pattern in dangerous_patterns:\n            if pattern in query_upper :\n                return f\"错误：查询中包含不允许的操作: {pattern}\"\n        \n        # 执行查询\n        engine = create_engine(connection_string)\n        with engine.connect() as conn:\n            df = pd.read_sql_query(text(query), conn)\n        \n        if df.empty:\n            return \"查询成功，但结果为空\"\n        else:\n            return f\"查询成功，返回 {len(df)} 行数据:\\n\" + df.to_string()\n            \n    except Exception as e:\n        return f\"查询过程中出现错误: {str(e)}\"",
                "name": "sql_query",
                "description": "A simple calculator that performs basic arithmetic operations",
                "global_imports": [
                  {
                    "module": "sqlalchemy",
                    "imports": [
                      "create_engine",
                      "text"
                    ]
                  },
                  "pandas as pd"
                ],
                "has_cancellation_support": false
              }
            }
          ]
        }
      },
      {
        "provider": "autogen_agentchat.agents.AssistantAgent",
        "component_type": "agent",
        "version": 1,
        "component_version": 1,
        "description": "负责从数据中提取洞察。它接收原始数据，使用Python进行清洗、统计、可视化，并用自然语言总结出结论来直接回答用户的问题",
        "label": "Data_Analyst",
        "config": {
          "name": "Data_Analyst",
          "model_client": {
            "provider": "autogen_ext.models.openai.AzureOpenAIChatCompletionClient",
            "component_type": "model",
            "version": 1,
            "component_version": 1,
            "description": "GPT-4o Mini Azure OpenAI model client.",
            "label": "simens-gpt",
            "config": {
              "model": "gpt-4o",
              "api_key": "abbd31db76e04ba5ae9746743a0c5d6a",
              "azure_endpoint": "https://apimgateway.siemens-healthineers.com",
              "azure_deployment": "gpt-4o",
              "api_version": "2025-03-01-preview"
            }
          },
          "model_context": {
            "provider": "autogen_core.model_context.UnboundedChatCompletionContext",
            "component_type": "chat_completion_context",
            "version": 1,
            "component_version": 1,
            "description": "An unbounded chat completion context that keeps a view of the all the messages.",
            "label": "UnboundedChatCompletionContext",
            "config": {}
          },
          "description": "An agent that provides assistance with ability to use tools.",
          "system_message": "你是一名数据分析专家（Data_Analyst），是团队中的业务洞察专家。你的核心职责是对SQL专家 (Sql_Specialist) 查询出的原始数据进行业务层面的分析和总结，形成易于理解的答案。\n一．\t核心原则\n1.\t输入与输出\n1)\t你的输入来自项目经理，包含两部分：\na.\t用户输入 (User_Question)：需要回答的原始业务问题。\nb.\t原始数据 (Raw_Data)：由SQL专家（Sql_Specialist）提供的SQL查询结果\n2)\t你的输出是：\n 一份直接、完整、结论清晰的最终答案，旨在直接回复用户。答案应基于数据，并包含你的专业分析和总结\n\n2.\t禁止操作数据库\n       你只能使用提供的原始数据，绝不能自行尝试连接数据库或生成SQL或编造数据。\n\n3.\t聚焦业务\n你的价值在于将冰冷的数据转化为有业务意义的洞察。避免做“人肉报表”，要提供数据背后的含义\n4.\t字段理解\n请充分运用提供的字段解释来深化你的分析\n表关键字段说明\n1)\t表ModelCapaSsme信息如下：\n       字段R,C,T,M,P,O,FileCount,EntryDate,Creator,StockClean,Conclusion，ErrorInSupplierEvaluationAssessed, SCARorCAPA:字段无用，可忽略查询\nDeliveryDate : 有缺陷的物料退还给供应商的时间（字符串格式，需转换成日期）\nCloseDate: 此单问题关闭的时间（字符串格式，需转换成日期）\nSourceId：此单问题的id，唯一标识这条数据（字符串格式）\nCreateDate：此单问题创建时间（字符串格式，需转换成日期）\nReporter：此单问题的报告人，创建人\nDefectivePartMaterialNumber：缺陷物料号（字符串格式，关联 MESG_EXPORT.MATNR）\nDefectivePartDescription：缺陷物料的描述\nDefectivePartSerialNumber：缺陷物料的序列号，是物料的唯一标识\nActionCodeFactor：此单问题涉及到缺陷物料的数量（字符串格式，需转换成INT）\nRevStatusDefectPart: 当前缺陷物料的版本号，是两位数字，例如00，01，02。\nSupplier：供应商代码\nSupplierName：供应商名称\nProblemDescription：此单问题的具体描述，可能包含了问题以什么形式表现，具体问题描述，调查的这个问题的过程或结果以及评估人/调查人\n                                           有中英文固定模板。\n                                            中文模板：问题描述：调查评估： 评估人：\n                                            英文模板：Description:Evalution:Evaluated by\nActionCode：行动代码，代表的这个缺陷物料是如何处理的（如500= return to Supplier，6 internal repair，600 Concession 让步接收，有点问题但是能够接受 88 dispose报废等）\nFailureClassification: 部门SQE或PE对此单问题性质的评估，对应值有：Gantry Replacement  ,Rust,Function,Noise,Insert,Label,Logistic,Machining,Dimension/Surface\n        Issue description, Torque, Retest ,Casting,或许还有更多\nAdditionalInformation：其他的备注信息，不一定是什么\nResponsibility：此单问题的责任方，对应的值Pending，Others，SSME,Customer\nFixTime：问题产生后工时的影响时间（小时，字符串需转decimal(7,2)计算）\nSystemMaterialNumber，SystemDescription，SystemSerialNumber 这三个字段对应系统的物料号，实际生产已经开始发现的物料问题才会有这个信息\nComponentMaterialNumber, ComponentDecription, ComponentSerialNumber这三个字段对应缺陷物料上级物料号，如果有上级部件才会有这个信息\nSource: 此单信息来源，目前都是SCMIS\n\n2)\t表MESG_EXPORT信息如下：\nMaterialNumber ：物料号（关联缺陷物料号）\nMovementType ： 移动类型\nQty ：消耗的熟料\nConsumeDate ：物料消耗/交付时间\n3)\t表EINA_EXPORT信息如下\n       MATNR ：物料号（关联缺陷物料号）\n       Supplier ：供应商编号\n4)\t表 SQESupplierTarget信息如下\n       Supplier:供应商代码\n       SupplierName：供应商名称\n       DowntimeMonthly：月度供应商的dowetime时间，单位是小时\n       FYear: 对应的年份，供应商每年的目标值都是不一样的\n                    求供应商9400054在2025年7月的消耗物料数量，可以用如下语句 \nselect SUM(CASE WHEN MovementType = '261' THEN qty ELSE 0 END) - SUM(CASE WHEN MovementType = '262' THEN qty ELSE 0 END) AS Result from [MESG_EXPORT] where materialnumber in (select * from EINA_EXPORT where supplier = '9400054' ) AND CONVERT(datetime, consumedate) >= '2025-07-01' AND CONVERT(datetime, consumedate) <= '2025-07-31'\n\n\n5.\t明确边界：如果数据无法完全解答用户问题，或需要进一步查询，请在分析中明确说明这一局限性\n",
          "model_client_stream": false,
          "reflect_on_tool_use": false,
          "tool_call_summary_format": "{result}",
          "metadata": {}
        }
      },
      {
        "provider": "autogen_agentchat.agents.AssistantAgent",
        "component_type": "agent",
        "version": 1,
        "component_version": 1,
        "description": "你是意图识别专家，是团队中的“调度前锋”。你的唯一任务是精准分析用户问题的意图，并将其分类，以便项目经理能将问题路由给最合适的专家。你无需回答问题本身。",
        "label": "Intention_Analyst",
        "config": {
          "name": "Intention_Analyst",
          "model_client": {
            "provider": "autogen_ext.models.openai.AzureOpenAIChatCompletionClient",
            "component_type": "model",
            "version": 1,
            "component_version": 1,
            "description": "GPT-4o Mini Azure OpenAI model client.",
            "label": "simens-gpt",
            "config": {
              "model": "gpt-4o",
              "api_key": "abbd31db76e04ba5ae9746743a0c5d6a",
              "azure_endpoint": "https://apimgateway.siemens-healthineers.com",
              "azure_deployment": "gpt-4o",
              "api_version": "2025-03-01-preview"
            }
          },
          "model_context": {
            "provider": "autogen_core.model_context.UnboundedChatCompletionContext",
            "component_type": "chat_completion_context",
            "version": 1,
            "component_version": 1,
            "description": "An unbounded chat completion context that keeps a view of the all the messages.",
            "label": "UnboundedChatCompletionContext",
            "config": {}
          },
          "description": "An agent that provides assistance with ability to use tools.",
          "system_message": "你是意图识别专家，是团队中的“调度前锋”。你的唯一任务是精准分析用户问题的意图，并将其分类，以便项目经理能将问题路由给最合适的专家。你无需回答问题本身。\n一．\t你的工作流程\n1.\t从项目经理（Manager）获取到用户输入\n2.\t分析用户问题，仔细解读用户输入的自然语言问题\n3.\t判断核心意图：根据预定义的规则，判断问题是否与“供应商分析”相关\n供应商分析相关问题的关键词（包括但不限于）：\n供应商名称：如“Siemens Healthcare GmbH SHS DI CT”、“Shanghai Liangzhi Electric Technology Co. Ltd.”\n绩效/质量：如“绩效”、“质量”、“表现”、“评估”、“评级” 、”数量”\n问题/缺陷：如“缺陷率”、“故障”、“维修”、“退货”、“报废”、“NCM”\n时间/效率：如“修复时间”、“响应时间”、“交付及时率”，“fixtime”\n打分/评分：如“打分”、“评分”、“分数”、“Report”\n\n4.\t决定数据需求：判断解决该问题是否需要从数据库（ModelCapaSsme 或 MESG_EXPORT 表或SQESupplierTarget或EINA_EXPORT）中查询原始数据。\n5.\t输出标准化分类：将你的分析结果告诉项目经理（Manager）以便他能根据你的结论找到最适合的专家\n分类关键字包括但不限于：供应商打分-需数据，供应商分析-需数据，其他领域-无需数据\n",
          "model_client_stream": false,
          "reflect_on_tool_use": false,
          "tool_call_summary_format": "{result}",
          "metadata": {}
        }
      },
      {
        "provider": "autogen_agentchat.agents.AssistantAgent",
        "component_type": "agent",
        "version": 1,
        "component_version": 1,
        "description": "An agent that provides assistance with ability to use tools.",
        "label": "Report_Analyst",
        "config": {
          "name": "Report_Analyst",
          "model_client": {
            "provider": "autogen_ext.models.openai.AzureOpenAIChatCompletionClient",
            "component_type": "model",
            "version": 1,
            "component_version": 1,
            "description": "GPT-4o Mini Azure OpenAI model client.",
            "label": "simens-gpt",
            "config": {
              "model": "gpt-4o",
              "api_key": "abbd31db76e04ba5ae9746743a0c5d6a",
              "azure_endpoint": "https://apimgateway.siemens-healthineers.com",
              "azure_deployment": "gpt-4o",
              "api_version": "2025-03-01-preview"
            }
          },
          "model_context": {
            "provider": "autogen_core.model_context.UnboundedChatCompletionContext",
            "component_type": "chat_completion_context",
            "version": 1,
            "component_version": 1,
            "description": "An unbounded chat completion context that keeps a view of the all the messages.",
            "label": "UnboundedChatCompletionContext",
            "config": {}
          },
          "description": "An agent that provides assistance with ability to use tools.",
          "system_message": "你是一名供应商打分报告专家（Report_Analyst），是团队中专精于供应商绩效评估的成员。你的核心职责是根据SQL专家 (Sql_Specialist) 提供的原始数据，计算供应商交付质量（Supplier Delivery Quality, SDQ）和停线时间（Downtime）得分，并依据标准打分规则进行综合评分，最后生成简洁明了的打分报告和分析总结。\n一．\t核心原则\n1.\t输入与输出\n                           你的输入来自项目经理，包含两部分\n1)\t用户问题 (User_Question)：需要回答的原始业务问题，通常涉及供应商打分或评估\n2)\t原始数据 (Raw_Data)：由SQL专家（Sql_Specialist）提供的SQL查询结果，必须包含供应商名称或标识符，供应商月度目标的停线时间，计算SDQ和停线时间所需的数据。\n计算SDQ需要所有物料出问题的数量和所有消耗的物料数量；\n计算停线时间需要每月解决生产线上材料问题所消耗的总时间（以小时为单位）\n\n2.\t你的输出是：\n一份直接、完整的打分报告和分析总结，包括物料消耗量，出问题的物料数量，SDQ值及其得分、停线时间及其得分、总分以及简要解释，旨在直接回复用户。答案应基于数据，并符合打分规则。\n3.\t打分规则\n你必须严格遵守以下打分规则进行计算：\n                           1) 供应商交付质量（SDQ）打分规则：占30分\n      SDQ计算公式：供应商交付质量（SDQ）等于1减去所有物料出问题的数量除以所有消耗的物料数量，再乘以100%。即：SDQ = [1 - (所有物料出问题的数量/ 所有消耗的物料数量)] × 100%。\n打分标准基于物料月度消耗量：\n如果月度消耗量小于200：\nSDQ大于或等于97%，得30分。\nSDQ大于90%但小于97%，得20分。\nSDQ小于或等于90%，得10分。\n如果月度消耗量在200到500之间（包含200和500）：\nSDQ大于或等于98%，得30分。\nSDQ大于95%但小于98%，得20分。\nSDQ小于或等于95%，得10分。\n如果月度消耗量大于500：\nSDQ大于或等于99%，得30分。\nSDQ大于97%但小于99%，得20分。\nSDQ小于或等于97%，得10分。\n特殊情况：如果月度消耗量为0，那么当NCM数量为0时，得30分；当NCM数量不为0时，得10分。\n\n    2) 停线时间打分规则：占25分\n                             每月解决生产线上材料问题所消耗的总时间（单位：小时），每家供应商有自己相应的目标值.\n打分标准：\n停线时间 < 目标值的一半，得25分。\n目标值的一半 < 停线时间 < 目标值，得20分。\n目标值 < 停线时间 < 目标值的2倍，得10分。\n目标值的2倍 < 停线时间 < 目标值的3倍，得5分。\n目标值的3倍 < 停线时间，得0分。\n\n    3) 总分计算\n          最终得分 = SDQ得分 + 停线时间得分（满分55分）。\n\n4.\t禁止操作数据库：你只能使用提供的原始数据和调用工具获取目标值，绝不能自行尝试连接数据库或生成SQL。也绝不能编造数据\n5.\t确保计算基于正确的数据字段。停线时间单位需统一为小时\n\n二．\t工作流程\n1.\t确认输入：首先，确认你已接收到完整的用户问题和对应的原始数据。\n数据必须包含计算SDQ所需的NCM数量，出问题的物料数量，消耗的物料数量，计算停线时间所需的总时间消耗，供应商标识符和，该供应商的停线时间目标值。如果数据缺失，请求项目经理提供补充信息。\n2.\t计算SDQ及其得分\n1)\t使用提供的原始数据，计算SDQ值。确保计算准确，遵循核心规则中的打分规则下计算SDR的公式\n2)\t从数据中识别物料月度消耗量，并判断属于哪个范围（小于200、200-500、或大于500）\n3)\t根据月度消耗量范围和SDQ值，对照SDQ打分标准，确定SDQ得分\n3.\t获取目标值并计算停线时间得分\n1)\t从原始数据中提取供应商名称或标识符。\n2)\t从原始数据中确定该供应商的停线时间目标值（单位：小时）。\n3)\t从原始数据中获取每月解决生产线上物料问题所消耗的总时间（停线时间）（单位：小时）\n4)\t将总停线时间与目标值比较，对照停线时间打分标准，确定停线时间得分。\n4.\t计算总分并生成报告\n1)\t计算最终得分（SDQ得分 + 停线时间得分）。\n2)\t直接回应用户问题，清晰陈述SDQ值及其得分、停线时间及其得分、以及总分。然后列出依据和计算逻辑，详细数据包含所有消耗的物料数量，所有NCM数量，所有出问题的物料的数量，具体的停线时间，停线时间目标值等\n3)\t提供简要的业务分析，解释得分含义（例如，得分高表示供应商交付质量好且响应效率高）。\n4)\t如果数据有异常，比如目标值不存在或不足，在报告中说明\n5.\t输出结果\n将计算总分和生成的报告返回给项目经理，无需添加其他操作建议或问候语。\n\n现在请清晰理解你的角色和职责，后续任务将直接按此规范执行\n",
          "model_client_stream": false,
          "reflect_on_tool_use": false,
          "tool_call_summary_format": "{result}",
          "metadata": {}
        }
      }
    ],
    "termination_condition": {
      "provider": "autogen_agentchat.base.OrTerminationCondition",
      "component_type": "termination",
      "version": 1,
      "component_version": 1,
      "label": "OrTerminationCondition",
      "config": {
        "conditions": [
          {
            "provider": "autogen_agentchat.conditions.TextMentionTermination",
            "component_type": "termination",
            "version": 1,
            "component_version": 1,
            "description": "Terminate the conversation if a specific text is mentioned.",
            "label": "TextMentionTermination",
            "config": {
              "text": "TERMINATE"
            }
          },
          {
            "provider": "autogen_agentchat.conditions.MaxMessageTermination",
            "component_type": "termination",
            "version": 1,
            "component_version": 1,
            "description": "Terminate the conversation after a maximum number of messages have been exchanged.",
            "label": "MaxMessageTermination",
            "config": {
              "max_messages": 20,
              "include_agent_event": false
            }
          }
        ]
      }
    },
    "emit_team_events": false
  }
}